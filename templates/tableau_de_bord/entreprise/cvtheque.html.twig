{% extends 'tableau_de_bord/base_entreprise.html.twig' %}

{% block title %}Tableau de bord{% endblock %}

{% block body %}

    <div class="loader-container" id="loader-container" style="display:none;">
        <span class="loader"></span>
    </div>

    <section class="">
        <div class="breadcrumb-card mb-25 d-md-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center">
                <a href="javascript:history.back()" class="d-block btn btn-info fw-semibold text-uppercase me-3 btn_retour">
                <i class="mx-2 bi bi-arrow-left"></i>Retour</a>
                <h5 class="mb-0"> CVthèque </h5>
            </div>
            <ol class="breadcrumb list-unstyled mt-0 mb-0 pl-0">
                <li class="breadcrumb-item position-relative"> 
                    <a routerlink="{{ path('app_tableau_de_bord_entreprise')}}" class="d-inline-block position-relative" href="{{ path('app_tableau_de_bord_entreprise')}}">
                    <i class="ri-home-8-line"></i> Tableau de bord </a>
                </li>
                <li class="breadcrumb-item position-relative"> CVthèque </li>
            </ol>
        </div>
    </section>
    {% if not entreprise.isIsPremium %}
    <section class="warning_freemium mb-4 d-flex align-items-center">
        <span><img src="{{ asset('v2/images/dashboard/warning_outline_icon.svg')}}" alt=""></span>
        <div class="warning-block">
            Vous êtes actuellement sur un plan gratuit. commencez notre <a routerlink="{{ path('app_tableau_de_bord_entreprise_tarifs')}}" class="btn-primary" href="{{ path('app_tableau_de_bord_entreprise_tarifs')}}">abonnement premium</a> pour accéder à notre CVthèque exclusive et publier des annonces en illimité !.
        </div>
    </section>
    {% endif %}
    {% set filter_title = app.request.query.get('filter-title', filterTitle) %}
    {% set filter_gender = app.request.query.get('filter-gender', '') %}
    {% set filter_degree = app.request.query.get('filter-degree', '') %}
    {% set filter_year = app.request.query.get('filter-year', '') %}
    <section class="recruteur-container">
        <div class="recruteur-block d-block p-5 mb-4">
            <div class="recruteur-top-item recruteur-filter">
                <h1>Votre succès commence avec les bons candicats!</h1>
                <form action="{{ path('app_tableau_de_bord_entreprise_cvtheque')}}" class="form-search filter-listing-form-wrapper" method="GET">
                    <div class="filter-listing-form">
                        <div class="main-inner clearfix">
                            <div class="content-main-inner">
                                <div class="row">
                                    <div class="col-xs-12 col-md-10  col-sm-8 has-border">
                                        <div class="form-group-inner has-icon">
                                            <i class="bi bi-search"></i>
                                            <input type="text" name="filter-title" class="form-control " value="{{filter_title}}" placeholder="profil recherche, mot cle">
                                        </div>
                                    </div>
                                    <div class="col-xs-12 col-md-2  col-sm-4 wrapper-submit flex-middle">
                                        <button class="btn-submit btn btn-inverse" type="submit">Trouver des candidats</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {#Sous filtre - il s'affiche après la première recherche pour une recherche plus poussée#}
                        <div class="advance-search-wrapper">
                            <h2>Une recherche plus précise ?</h2>
                            <div class="advance-search-wrapper-fields">
                                <div class="row">
                                    <div class="col-xs-12 col-md-4 has-border">
                                        <div class="form-group-inner form-group-genre">
                                            <select name="filter-gender" class="form-control select2-hidden-accessible" data-placeholder="Genres" tabindex="-1" aria-hidden="true">
                                                <option value="0">Genres</option>
                                                <option value="1">Tous genres</option>
                                                <option value="2">feminins</option>
                                                <option value="3">Masculins</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-xs-12 col-md-4 has-border">
                                        <div class="form-group-inner form-group-degree">
                                            <select name="filter-degree" class="form-control select2-hidden-accessible" data-placeholder="Qualification" tabindex="-1" aria-hidden="true">
                                                <option value="">Qualification</option>
                                                <option value="">Certificat</option>
                                                <option value="">Diplôme d'associé</option>
                                                <option value="">Licence Je travaille</option>
                                                <option value="">Une maîtrise</option>
                                                <option value="">Doctorat</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-xs-12 col-md-4">
                                        <div class="form-group-inner form-group-year">
                                            <select name="filter-year" class="form-control select2-hidden-accessible" data-placeholder="Experiences" tabindex="-1" aria-hidden="true">
                                                <option value="">Experiences</option>
                                                <option value="">Moins d'un an</option>
                                                <option value="">2 ans</option>
                                                <option value="">3 ans</option>
                                                <option value="">4 ans</option>
                                                <option value="">5 ans et +</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="recruteur-block list-profil d-block p-5 mb-4">
            <div class="layout-profil-container">
                <div class="d-flex ordering-wrapper mb-4 justify-content-between">
                    <div class="results-count">Affichage de 1 - {{ searchResults|length }} sur {{ totalResults }} résultats</div>								
                    <form>
                        <div class="form-group d-flex align-items-center">
                            <h4 class="section-head-small">Afficher par</h4>
                            <div class="dropdown bootstrap-select">
                                <select class="select-bar-large selectpicker" data-live-search="true" data-bv-field="size" tabindex="null">
                                    <option>10</option>
                                    <option>20</option>
                                    <option>30</option>
                                    <option>40</option>
                                    <option>50</option>
                                    <option>60</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="item_profil-container">
                    <div class="row">
                        {% for item in searchResults %}
                        <div class="col-xl-6">
                            <div class="candidate-card">
                                <div class="candidate-card-item">
                                    <div class="d-flex align-items-center mb-2">
                                        <div class="candidate-photo">
                                            <a href=""><img src="{{ item.fileName ? asset('uploads/experts/' ~ item.fileName) : asset('v2/images/dashboard/.svg')}}" alt=""></a>
                                        </div>
                                        <div class="candidate-info-content">
                                            <h2>{{ generatePseudo(item)}}</h2>
                                            <div class="featured d-md-flex align-items-center">{{ item.titre }} <span class="certificated">Certifié</span></div>
                                            {% if isLikedByRecruiter(entreprise, item.id) %}
                                            <span class="favoris-add" id="row_star_favorite_{{ item.id }}"><i class="bi bi-star-fill"></i></span>
                                            {% else %}
                                            <span class="favoris-add" id="row_star_favorite_{{ item.id }}"><i class="bi bi-star"></i></span>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="infos-middle d-flex align-items-center">
                                        <div class="ville-info"><i class="bi bi-pin"></i> {{ show_country(item.localisation) }}</div>
                                        <div class="pretention-info"><i class="bi bi-cash-coin"></i> {{ item.tarifCandidat }}</div>
                                    </div>
                                    <div class="infos-desc">
                                        {% if item.metaDescription is defined and item.metaDescription is not null %}
                                            {{ item.metaDescription }}
                                        {% else %}
                                            Ideo urbs venerabilis post superbas efferatarum gentium cervices oppressas latasque leges fundamenta libertatis et retinacula sempiterna velut frugi parens et prudens et dives Caesaribus tamquam liberis suis regenda patrimonii iura permisit.
                                        {% endif %}
                                    </div>
                                    <div class="infos-footer d-flex align-items-center">
                                        <a class="btn btn-outline" href="{{ path('app_tableau_de_bord_entreprise_profil_candidat', {'id': item.id })}}">Voir son profil</a>
                                        <div id="row_favorite_{{ item.id }}">
                                            {% if isLikedByRecruiter(entreprise, item.id) %}
                                                <button type="button" class="btn btn-info remove-from-favorites" data-href="{{ path('app_v2_recruiter_favorite_delete_candidate', {'id':item.id}) }}"><i class="bi bi-star-fill me-2"></i>Effacer de mes favoris</button>
                                            {% else %}
                                                <button type="button" class="btn btn-primary text-primary add-to-favorites" data-href="{{ path('app_v2_recruiter_favorite_add_candidate', {'id':item.id}) }}"><i class="bi bi-star me-2"></i>Ajouter à mes favoris</button>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        <!-- Pagination -->
        {% if totalPages > 1 %}
        <nav aria-label="Pagination">
            <ul class="pagination justify-content-center">
                <!-- Lien "Précédent" -->
                <li class="page-item {% if currentPage == 1 %}disabled{% endif %}">
                    <a class="page-link" href="{{
                        path('app_tableau_de_bord_entreprise_cvtheque', {
                            'page': currentPage - 1
                        }|merge(app.request.query.all))
                    }}">Précédent</a>
                </li>

                <!-- Liens des pages -->
                {% for i in 1..totalPages %}
                    {% if totalPages <= 6 or i == 1 or i == totalPages or (i >= currentPage - 2 and i <= currentPage + 2) %}
                        <li class="page-item {% if i == currentPage %}active{% endif %}">
                            <a class="page-link" href="{{
                                path('app_tableau_de_bord_entreprise_cvtheque', {
                                    'page': i,
                                    'filter-title': filter_title
                                }|merge(app.request.query.all))
                            }}">{{ i }}</a>
                        </li>
                    {% elseif i == currentPage - 3 or i == currentPage + 3 %}
                        <li class="page-item disabled">
                            <span class="page-link">...</span>
                        </li>
                    {% endif %}
                {% endfor %}

                <!-- Lien "Suivant" -->
                <li class="page-item {% if currentPage == totalPages %}disabled{% endif %}">
                    <a class="page-link" href="{{
                        path('app_tableau_de_bord_entreprise_cvtheque', {
                            'page': currentPage + 1
                        }|merge(app.request.query.all))
                    }}">Suivant</a>
                </li>
            </ul>
        </nav>
        {% endif %}

    </section>

{# 
                        <!-- si favoris active ajout class active a côte de favoris-add  -->
                        <div class="col-xl-6">
                            <div class="candidate-card">
                                <div class="candidate-card-item">
                                    <div class="d-flex align-items-center mb-2">
                                        <div class="candidate-photo">
                                            <a href=""><img src="{{ asset('v2/images/dashboard/.svg')}}" alt=""></a>
                                        </div>
                                        <div class="candidate-info-content">
                                            <h2>Nom & prénoms</h2>
                                            <div class="featured d-md-flex align-items-center">Marketing <span class="certificated">Certifié</span></div>
                                            <button class="favoris-add active"><i class="bi bi-star"></i></button>
                                        </div>
                                    </div>
                                    <div class="infos-middle d-flex align-items-center">
                                        <div class="ville-info"><i class="bi bi-pin"></i> Antananarivo</div>
                                        <div class="pretention-info"><i class="bi bi-cash-coin"></i> 230K / jour</div>
                                    </div>
                                    <div class="infos-desc">
                                        Ideo urbs venerabilis post superbas efferatarum gentium cervices oppressas latasque leges fundamenta libertatis et retinacula sempiterna velut frugi parens et prudens et dives Caesaribus tamquam liberis suis regenda patrimonii iura permisit.
                                    </div>
                                    <div class="infos-footer d-flex align-items-center">
                                        <a class="btn btn-outline" href="{{ path('app_tableau_de_bord_entreprise_profil_candidat', {'id': 3634 })}}">Voir son profil</a>
                                        <a class="btn" href="">Consulter son CV directement</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- si profil le plus visite ajout <span class="diamond_"> à côte du nom  -->
                        <div class="col-xl-6">
                            <div class="candidate-card">
                                <div class="candidate-card-item">
                                    <div class="d-flex align-items-center mb-2">
                                        <div class="candidate-photo">
                                            <a href=""><img src="{{ asset('v2/images/dashboard/.svg')}}" alt=""></a>
                                        </div>
                                        <div class="candidate-info-content">
                                            <h2>Nom & prénoms 
                                                <span class="diamond_">
                                                    <img src="{{ asset('v2/images/dashboard/diamond_icon.svg')}}" alt="">
                                                    <div class="popover">
                                                        <div class="popover-content">Profil le plus visité</div>
                                                    </div>
                                                </span>
                                            </h2>
                                            <div class="featured d-md-flex align-items-center">Marketing <span class="certificated">Certifié</span></div>
                                            <button class="favoris-add active"><i class="bi bi-star"></i></button>
                                        </div>
                                    </div>
                                    <div class="infos-middle d-flex align-items-center">
                                        <div class="ville-info"><i class="bi bi-pin"></i> Antananarivo</div>
                                        <div class="pretention-info"><i class="bi bi-cash-coin"></i> 230K / jour</div>
                                    </div>
                                    <div class="infos-desc">
                                        Ideo urbs venerabilis post superbas efferatarum gentium cervices oppressas latasque leges fundamenta libertatis et retinacula sempiterna velut frugi parens et prudens et dives Caesaribus tamquam liberis suis regenda patrimonii iura permisit.
                                    </div>
                                    <div class="infos-footer d-flex align-items-center">
                                        <a class="btn btn-outline" href="{{ path('app_tableau_de_bord_entreprise_profil_candidat', {'id': 3634 })}}">Voir son profil</a>
                                        <a class="btn" href="">Consulter son CV directement</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                 #}
{% endblock %}
