{% extends 'base_coworking.html.twig' %}

{% block title %}Contrat Membre VIP - Olona Talents{% endblock %}

{% block meta %}
<meta name="description" content="Découvrez les avantages exclusifs du Contrat Membre VIP chez Olona Talents : réservations prioritaires, connexion haut débit Starlink, et bien plus.">
<meta name="keywords" content="Contrat Membre VIP, Olona Talents, Réservation Prioritaire, Starlink, Coworking, Madagascar">
<meta property="og:title" content="Contrat Membre VIP - Olona Talents">
<meta property="og:description" content="Profitez des avantages uniques du Contrat Membre VIP chez Olona Talents. Inscrivez-vous dès aujourd'hui pour bénéficier de services premium.">
<meta property="og:url" content="{{ app.request.uri }}">
<meta property="og:image" content="{{ app.request.schemeAndHttpHost ~ asset('/images/opengraph/vip.png') }}">
<meta property="og:image:width" content="1200"/>
<meta property="og:image:height" content="630"/>
{% endblock %}
{% block stylesheets %}
    {{ parent() }}
    
<style>
    #formStepsIndicator {
        counter-reset: step;
    }
    .step-indicator {
        position: relative;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        background-color: #f0f0f0;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        margin: 0 15px;
        cursor: pointer;
    }
    
    .step-indicator.active {
        background-color: #007bff;
        color: white;
    }
    
    .step-indicator::before,
    .step-indicator::after {
        content: '';
        position: absolute;
        top: 50%;
        width: 50px;
        height: 2px;
        background-color: #ddd;
    }
    
    .step-indicator::before {
        left: -50px;
    }
    
    .step-indicator::after {
        right: -50px;
    }
    
    .step-indicator:first-child::before,
    .step-indicator:last-child::after {
        content: none;
    }
    </style>    
{% endblock %}
{% block paralax %}
<div class="paralax product-design">
    {% include "coworking/_nav.html.twig" %}
    <div class="main-content-min">
      <div class="container">
        <!-- Content Section -->
        <div class="row">
          <div class="col-12 col-sm-8 mx-auto text-center">
            <h1 class="display-4 fw-bolder">Formulaire Membre VIP</h1>
          </div>
        </div>
        <!-- Social Links and Address Section in Line -->
        <div class="row">
          <div class="col-md-6 d-flex align-items-center justify-content-center">
            <!-- Social links -->
            <ul class="list-inline">
              <li class="list-inline-item">
                <a class="text-white text-opacity-75 text-primary-hover" target="_blank" href="https://www.linkedin.com/company/emploi-madagascar/posts?lipi=urn%3Ali%3Apage%3Ad_flagship3_search_srp_all%3BiwUwllhjTX2REM32%2BAYkfQ%3D%3D">
                  <i class="bi bi-linkedin"></i>
                </a>
              </li>
              <li class="list-inline-item ms-3">
                <a class="text-white text-opacity-75 text-primary-hover" target="_blank" href="https://www.facebook.com/olonatalents">
                  <i class="bi bi-facebook"></i>
                </a>
              </li>
            </ul>
          </div>
          <div class="col-md-6 small">
            <!-- Address -->
            <p class="font-serif text-white text-opacity-75 text-md-end">
              <i class="bi bi-geo-alt-fill"></i> Ambatonakanga, Antananarivo, Madagascar
            <br>
              <i class="bi bi-clock-history"></i>
              Lundi au Vendredi de 8h à 18h
            <br>
              Week-end - Privatisation uniquement
              <br>
              <i class="bi bi-phone"></i><a class="text-white" href="tel:+261320373431">+261 32 03 734 31</a>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block admin %}{% endblock %}

{% block body %}
<section class="p-0 m-0">
    <div class="container my-5">
        <div class="row p-4 pb-0 pe-lg-0 pt-lg-5 align-items-center rounded-3 border shadow-lg">
            <div class="row mb-5">
                <section>
                    <div class="container">  
                        
                            <ul class="nav nav-pills justify-content-center mb-4" id="formStepsIndicator">
                                <li class="nav-item">
                                    <button class="nav-link rounded-circle mx-2 mx-lg-5 active" type="button" data-step="1">1</button>
                                </li>
                                <li class="nav-item">
                                    <button class="nav-link rounded-circle mx-2 mx-lg-5" type="button" data-step="2" disabled>2</button>
                                </li>
                                <li class="nav-item">
                                    <button class="nav-link rounded-circle mx-2 mx-lg-5" type="button" data-step="3" disabled>3</button>
                                </li>
                            </ul>
                            <div id="contractFormStep">
                                {{form_start(form) }}
                                <div id="step-1" class="step">
                                    <h3>Étape 1 : Mes infos</h3>
                                    <div class="py-5">
                                        {{ form_errors(form) }}
                                        {{ form_row(form.typePerson) }}
                                        <div class="row">
                                            <div class="col-md-6">{{ form_row(form.firstName) }}</div>
                                            <div class="col-md-6">{{ form_row(form.lastName) }}</div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">{{ form_row(form.socialReason) }}</div>
                                            <div class="col-md-6">{{ form_row(form.siret) }}</div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">{{ form_row(form.email) }}{{ form_errors(form.email) }}<div class="invalid-feedback"></div></div>
                                            <div class="col-md-6">{{ form_row(form.telephone) }}{{ form_errors(form.telephone) }}<div class="invalid-feedback"></div></div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">{{ form_row(form.adress) }}<div class="invalid-feedback"></div></div>
                                            <div class="col-md-6">{{ form_row(form.postalCode) }}<div class="invalid-feedback"></div></div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">{{ form_row(form.city) }}<div class="invalid-feedback"></div></div>
                                            <div class="col-md-6">{{ form_row(form.localisation) }}<div class="invalid-feedback"></div></div>
                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-primary next-step">Suivant</button>
                                </div>
                            
                                <div id="step-2" class="step d-none">
                                    <h3>Étape 2 : Conditions d'utilisation</h3>
                                    
                                        <div class="container my-5" style="height: 420px; overflow-y: auto;">

                                            <!-- Section 1: Préambule -->
                                            <div class="mb-4">
                                            <h2 class="h4">1. Préambule</h2>
                                            <p>
                                                Les présentes conditions d'utilisation régissent les modalités et conditions applicables au Contrat Membre VIP Olona Talents, proposé par la société Olona Talents (ci-après dénommée "la Société"). En souscrivant à ce contrat, le client (ci-après dénommé "le Client") accepte les présentes conditions dans leur intégralité.
                                            </p>
                                            </div>

                                            <!-- Section 2: Objet du contrat -->
                                            <div class="mb-4">
                                            <h2 class="h4">2. Objet du contrat</h2>
                                            <p>
                                                Le Contrat Membre VIP Olona Talents offre des services exclusifs d'accès et d'utilisation des espaces de coworking, des outils numériques et des avantages personnalisés, tels que définis dans les sections suivantes.
                                            </p>
                                            </div>

                                            <!-- Section 3: Services inclus -->
                                            <div class="mb-4">
                                            <h2 class="h4">3. Services inclus</h2>
                                            <ul>
                                                <li>Réservations illimitées et prioritaires pour l'accès aux espaces de coworking (du lundi au vendredi, de 8h à 18h).</li>
                                                <li>Connexion haut débit via Starlink et service continu grâce aux groupes électrogènes.</li>
                                                <li>Publication facultative d’un post "Coworker du jour" sur notre page Facebook.</li>
                                                <li>Remises avantageuses : 25 % sur les autres services Olona Talents et 50 % pour les accompagnants.</li>
                                            </ul>
                                            </div>

                                            <!-- Section 4: Modalités de réservation -->
                                            <div class="mb-4">
                                            <h2 class="h4">4. Modalités de réservation</h2>
                                            <p>
                                                Les réservations doivent être effectuées à l'avance via l'un des canaux suivants :
                                            </p>
                                            <ul>
                                                <li>Moteur de réservation en ligne</li>
                                                <li>Messenger</li>
                                                <li>WhatsApp</li>
                                                <li>Téléphone</li>
                                            </ul>
                                            <p>
                                                En cas de privatisation ou d'indisponibilité des espaces, la Société se réserve le droit de refuser certaines réservations.
                                            </p>
                                            </div>

                                            <!-- Section 5: Engagement et renouvellement -->
                                            <div class="mb-4">
                                            <h2 class="h4">5. Engagement et renouvellement</h2>
                                            <p>
                                                Le contrat est conclu pour une durée mensuelle, renouvelable tacitement à chaque date d’anniversaire.
                                            </p>
                                            <p>
                                                Le Client peut résilier à tout moment, avec un préavis minimum de <strong>3 jours avant la date d'anniversaire mensuelle.</strong>
                                            </p>
                                            </div>

                                            <!-- Section 6: Conditions de paiement -->
                                            <div class="mb-4">
                                            <h2 class="h4">6. Conditions de paiement</h2>
                                            <p>
                                                <strong>Premier paiement :</strong> à la signature du contrat.<br>
                                                <strong>Paiements récurrents :</strong> à la date d’anniversaire mensuelle.
                                            </p>
                                            <p>
                                                <strong>Modes de paiement acceptés :</strong>
                                            </p>
                                            <ul>
                                                <li>Virement bancaire</li>
                                                <li>Mobile Money</li>
                                                <li>Espèces (au bureau)</li>
                                            </ul>
                                            <p>
                                                <strong>Retards de paiement :</strong>
                                            </p>
                                            <ul>
                                                <li>Un retard supérieur à <strong>7 jours</strong> entraîne la suspension des avantages contractuels et l'annulation de l'engagement tarifaire.</li>
                                                <li>Facturation basée sur les journées/demi-journées consommées, avec une majoration de <strong>10 %</strong> tous les 7 jours de retard.</li>
                                                <li>Procédure judiciaire en cas de non-paiement au-delà de 3 relances.</li>
                                            </ul>
                                            </div>

                                            <!-- Section 7: Engagement de la Société -->
                                            <div class="mb-4">
                                            <h2 class="h4">7. Engagement de la Société</h2>
                                            <p>
                                                La Société garantit les tarifs pour une période d’un an. Toute révision de l’offre ou des tarifs prendra effet à partir du <strong>1er janvier 2026</strong> et sera communiquée au Client avec un préavis de 30 jours.
                                            </p>
                                            </div>

                                            <!-- Section 8: Responsabilités et obligations -->
                                            <div class="mb-4">
                                            <h2 class="h4">8. Responsabilités et obligations</h2>
                                            <p>
                                                Le Client s'engage à respecter les conditions d'utilisation des espaces, notamment :
                                            </p>
                                            <ul>
                                                <li>Prévenir à l'avance de sa présence et de ses horaires.</li>
                                                <li>Utiliser les équipements et installations de manière responsable.</li>
                                            </ul>
                                            <p>
                                                La Société décline toute responsabilité en cas de dommages causés par une mauvaise utilisation des installations ou des services.
                                            </p>
                                            </div>

                                            <!-- Section 9: Législation applicable -->
                                            <div class="mb-4">
                                            <h2 class="h4">9. Législation applicable</h2>
                                            <p>
                                                Le contrat est régi et interprété conformément aux lois en vigueur à Madagascar. En cas de litige, les parties s’efforceront de trouver une solution à l’amiable. À défaut, le différend sera soumis à la juridiction compétente.
                                            </p>
                                            </div>
                                        </div>
                                        <div class="mb-5 h4 col-md-8 mx-auto">
                                            <div class="row">
                                                <div class="col-1 text-end">
                                                    {{ form_row(form.acceptTerms, {'attr': {'class': 'form-check-input', 'label': 'J\'accepte les conditions d\'utilisation'}}) }}
                                                </div>
                                                <div class="col">
                                                    <label class="form-check-label required" for="{{ form.acceptTerms.vars.id }}">J'accepte les conditions d'utilisation</label>
                                                </div>
                                            </div>
                                        </div>

                                    <button type="button" class="btn btn-secondary prev-step">Précédent</button>
                                    <button type="button" class="btn btn-primary next-step">Suivant</button>
                                </div>

                            
                                <div id="step-3" class="step d-none">
                                    <h3>Étape 3 : Paiement</h3>
                                    <div class="row pt-5">
                                        <div class="col-md-6 mb-4">
                                            <h2 class="h4">{{ package.name}}</h2>
                                            <p>
                                                {{ package.description}}
                                            </p>
                                            <p class="text-center my-5">
                                               <span class="fw-bolder h1">{{ package.price}} Ar </span><br><span class="fw-light h6">[ {{ price }} € ] </span>
                                            </p>
                                        </div>
                                        <div class="col-md-6 mx-auto">
                                            <section class="mb-5">
                                                <h6 class="">Payer au bureau</h6>
                                                <hr>
                                                <div class="d-grid gap-2">
                                                  <button type="submit" class="text-white btn btn-primary">
                                                    <i class="bi bi-wallet2 me-2 h4"></i>
                                                    Je paie en espèces
                                                  </button>
                                                </div>
                                            </section>
                                            <section class="mb-5">
                                                <h6 class="">Paiement via mobile Money</h6>
                                                <hr>
                                                <div class="d-grid gap-2">
                                                  <button type="button" class="text-white btn btn-secondary" disabled>
                                                    <i class="bi bi-phone-flip me-2 h4"></i>
                                                    Bientôt disponible
                                                  </button>
                                                </div>
                                            </section>
                                            <section class="mb-5">
                                                <h6 class="">Paiement sécurisé par PayPal</h6>
                                                <hr>
                                                <div class="d-grid gap-2">
                                                  <div id="paypal-button-container"></div>
                                                </div>
                                            </section>
                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-secondary prev-step">Précédent</button>
                                    <button type="submit" class="btn btn-primary">Soumettre</button>
                                </div>
                                <div style="display: none;">
                                    {{ form_widget(form)}}
                                </div>
                                {{ form_end(form)}}
                            </div>
                        <p class="mt-5"><small>Le Contrat Membre VIP Olona Talents est régie par les lois de Madagascar. Les tarifs sont garantis pour une durée d’un an avec une possibilité de révision à partir du 1er janvier 2026. Souscrivez aujourd'hui pour accéder à un monde d'optimisation et de qualité de service.</small></p>
                    </div>
                </section>

            </div>
        </div>
    </div>
</section>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script><script>
    $(document).ready(function(){
        var currentStep = 1;
        var totalSteps = $('.step').length;
    
        function showStep(step) {
            $('.step').addClass('d-none');
            $('#step-' + step).removeClass('d-none');
            updateStepIndicator(step);
        }
    
        function updateStepIndicator(step) {
            $('#formStepsIndicator .nav-link').each(function() {
                var btnStep = $(this).data('step');
                if(btnStep == step) {
                    $(this).removeClass('disabled').addClass('active');
                } else {
                    $(this).removeClass('active').attr('disabled', true);
                }
            });
        }
    
        function validateStep(step) {
            var isValid = true;
            $('#step-' + step + ' .form-control').each(function() {
                if (!this.checkValidity()) {
                    isValid = false;
                    $(this).addClass('is-invalid');
                    $(this).next('.invalid-feedback').text($(this).get(0).validationMessage);
                } else {
                    $(this).removeClass('is-invalid');
                    $(this).next('.invalid-feedback').text('');
                }
            });
            $('#step-' + step + ' .form-check-input').each(function() {
                if (!this.checkValidity()) {
                    isValid = false;
                    $(this).addClass('is-invalid');
                    $(this).next('.invalid-feedback').text($(this).get(0).validationMessage);
                } else {
                    $(this).removeClass('is-invalid');
                    $(this).next('.invalid-feedback').text('');
                }
            });
    
            return isValid;
        }
    
        showStep(currentStep);
    
        $('.next-step').click(function() {
            if (validateStep(currentStep)) {
                if (currentStep < totalSteps) {
                    currentStep++;
                    showStep(currentStep);
                    // Enable the next step in the indicator
                    $('#formStepsIndicator .nav-link').filter(`[data-step="${currentStep}"]`).removeAttr('disabled');
                }
            }
        });
    
        $('.prev-step').click(function() {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
            }
        });
    });
    </script>

<script>
    document.addEventListener('turbo:load', function () {
        
        console.log('DOM fully loaded and parsed');
        loadPaypalSdk().then(() => {
            initializePaypalButtons();
            console.log('PayPal SDK loaded and buttons initialized');
        }).catch(error => {
            console.error("Erreur lors du chargement du SDK PayPal:", error);
        });
    });
    
    function resultMessage(message) {
        console.log(message);
        const messageContainer = document.getElementById('message-container');
        if (messageContainer) {
            messageContainer.innerHTML = message;
            messageContainer.style.display = 'block';
        } else {
            console.error('Message container not found', message);
            // Vous pouvez également envisager d'ajouter une alternative de fallback ici
            // Par exemple, créer dynamiquement l'élément s'il n'existe pas
            createMessageContainer(message);
        }
    }
    
    function createMessageContainer(message) {
        const container = document.createElement('div');
        container.id = 'message-container';
        container.style.display = 'block';
        container.innerHTML = message;
        document.body.appendChild(container);  // Changez cela en fonction de l'endroit où vous voulez l'ajouter
    }
    
    async function saveTransaction(orderData) {
        try {
            const token = await getAuthToken();
    
            const response = await fetch('{{ path('app_v2_user_order_save', {'pack': 'vip-coworking', 'id': 1 })}}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}` 
                },
                body: JSON.stringify(orderData),
            });
    
            if (!response.ok) {
                throw new Error('Failed to save transaction');
            }
    
            const data = await response.json();
            console.log('Transaction saved:', data);
        } catch (error) {
            console.error('Error saving transaction:', error);
        }
    }
    
    async function getAuthToken() {
        try {
            const response = await fetch('{{ path('api_login_check')}}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    username: 'miandrisoa.olona@gmail.com',
                    password: 'HY9Hk86c',
                }),
            });
    
            if (!response.ok) {
                throw new Error('Failed to fetch token');
            }
    
            const data = await response.json();
            return data.token; 
        } catch (error) {
            console.error('Error obtaining token:', error);
            throw error;
        }
    }
    
    function loadPaypalSdk() {
        return new Promise((resolve, reject) => {
            if (window.paypal) {
                resolve();
            } else {
                const script = document.createElement('script');
                script.src = "https://www.paypal.com/sdk/js?client-id=AT3VNDtp1XLa-i5RiH6-64z02R0d2HawjrGs26oXddGZGnqJzxShg_Jwv3jJeyyCaE5gW-zrCZlZMG9J&components=buttons&enable-funding=venmo,paylater&currency=EUR";
                script.onload = () => resolve();
                script.onerror = () => reject(new Error('Échec du chargement du SDK PayPal'));
                document.head.appendChild(script);
            }
        });
    }
    
    function initializePaypalButtons() {
    
        window.paypal
        .Buttons({
            style: {
                layout: "vertical",
                color: "gold",
                label: "paypal",
            },
            message: {
                amount: {{ price }},
            } ,
    
            async createOrder() {
                try {
                    const response = await fetch("https://node.olona-talents.com/api/orders", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            cart: [
                                {
                                    id: "vip-coworking", 
                                    name: "Contrat Membre VIP",
                                    quantity: 1,          
                                    price: {{ price }},   
                                    currency: "EUR",      
                                },
                            ],
                        }),
                    });
    
                    const orderData = await response.json();
    
                    if (orderData.id) {
                        return orderData.id;
                    }
                    const errorDetail = orderData?.details?.[0];
                    const errorMessage = errorDetail
                        ? `${errorDetail.issue} ${errorDetail.description} (${orderData.debug_id})`
                        : JSON.stringify(orderData);
    
                    throw new Error(errorMessage);
                } catch (error) {
                    console.error(error);
                    resultMessage(`Impossible d'initier le paiement PayPal...<br>${error}`);
                }
            } ,
    
            async onApprove(data, actions) {
                try {
                    const response = await fetch(
                        `https://node.olona-talents.com/api/orders/${data.orderID}/capture`,
                        {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                        }
                    );
    
                    const orderData = await response.json();
                    const errorDetail = orderData?.details?.[0];
    
                    if (errorDetail?.issue === "INSTRUMENT_DECLINED") {
                        return actions.restart();
                    } else if (errorDetail) {
                        throw new Error(
                            `${errorDetail.description} (${orderData.debug_id})`
                        );
                    } else if (!orderData.purchase_units) {
                        throw new Error(JSON.stringify(orderData));
                    } else {
                        const transaction =
                            orderData?.purchase_units?.[0]?.payments
                                ?.captures?.[0] ||
                            orderData?.purchase_units?.[0]?.payments
                                ?.authorizations?.[0];
                        resultMessage(
                            `Transaction ${transaction.status}: ${transaction.id}`
                        );
                        console.log(
                            "Capture result",
                            orderData,
                            JSON.stringify(orderData, null, 2)
                        );
                        await saveTransaction(orderData);
                    }
                } catch (error) {
                    console.error(error);
                    resultMessage(
                        `Désolé, votre transaction n'a pas pu être traitée...<br>${error}`
                    );
                }
            } ,
        })
        .render("#paypal-button-container"); 
    
    }
    </script>
{% endblock %}
