{% extends 'dashboard/base.html.twig' %}

{% block body %}

<div class="container mt-5">
    <h2>Annonces</h2>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>
                    ID
                    <input type="text" id="filter-id" data-column="0" class="form-control form-control-sm" placeholder="Filtre">
                </th>
                <th>
                    Entreprise
                    <input type="text" id="filter-entreprise" data-column="1" class="form-control form-control-sm" placeholder="Filtre">
                </th>
                <th>
                    Titre
                    <input type="text" id="filter-titre" data-column="2" class="form-control form-control-sm" placeholder="Filtre">
                </th>
                <th>
                    Description
                    <input type="text" id="filter-description" data-column="3" class="form-control form-control-sm" placeholder="Filtre">
                </th>
                <th>
                    Status
                    <input type="text" id="filter-status" data-column="4" class="form-control form-control-sm" placeholder="Filtre">
                </th>
                <th>
                </th>
                <!-- ... Ajoutez les autres colonnes de la même manière ... -->
            </tr>
        </thead>
        <tbody>
            {% for annonce in annonces %}
                {% include "composants/table_annonce.html.twig" with {annonce: annonce} %}
            {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}

{% block javascript %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const filters = document.querySelectorAll('input[id^="filter-"]');
        for(let filter of filters) {
            filter.addEventListener('keyup', function() {
                const filterValue = filter.value.toLowerCase();
                const tbody = document.querySelector('tbody');
                for(let row of tbody.rows) {
                    const columnIndex = filter.getAttribute('data-column');
                    const cell = row.cells[columnIndex].textContent.toLowerCase();
                    if(cell.includes(filterValue)) {
                        row.style.display = "";
                    } else {
                        row.style.display = "none";
                    }
                }
            });
        }
    });

    document.addEventListener('DOMContentLoaded', function() {
        const statusSelect = document.querySelector('select[name="status"]');
        
        statusSelect.addEventListener('change', function() {
            const form = this.closest('form');
            const formData = new FormData(form);

            fetch(form.action, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    console.log(data.message);  // Affiche un message de succès
                }
            })
            .catch(error => {
                console.error('Erreur lors de la mise à jour du statut :', error);
            });
        });
    });    

</script>
{% endblock %}

{# {% block body %}

{% for annonce in annonces %}
    {% include "composants/table_annonce.html.twig" with {annonce: annonce} %}
{% endfor %}

{% endblock %} #}
